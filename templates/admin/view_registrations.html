<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Registrations - {{ form.name }} - AICC Admin</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="admin-dashboard">
    <nav class="admin-nav">
        <div class="nav-brand">
            <i class="fas fa-shield-alt"></i>
            AICC Admin Panel
        </div>
        <div class="nav-actions">
            <button id="theme-toggle" class="btn-theme">
                <i class="fas fa-sun"></i>
            </button>
            <a href="{{ url_for('admin_dashboard') }}" class="btn-back">
                <i class="fas fa-arrow-left"></i>
                Dashboard
            </a>
            <a href="{{ url_for('admin_logout') }}" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </a>
        </div>
    </nav>
    
    <div class="admin-container">
        <div class="admin-header">
            <h1>Registrations: {{ form.name }}</h1>
            <p>View and export registration data</p>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-circle' }}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div style="margin-bottom: 1rem;">
            <a href="{{ url_for('admin_events') }}" class="btn-back">
                <i class="fas fa-arrow-left"></i>
                Back to Events
            </a>
            {% if registrations %}
            <a href="{{ url_for('admin_export_registrations', event_id=event.id) }}" class="btn btn-success">
                <i class="fas fa-file-excel"></i> Export to Excel
            </a>
            {% endif %}
        </div>

<div class="info-card">
    <h3>Event: {{ event.name }}</h3>
    <p><strong>Total Registrations:</strong> {{ registrations|length }}</p>
    {% if registrations %}
    <p><strong>Entered:</strong> {{ registrations|selectattr('attendance_status', 'equalto', 'entered')|list|length }}</p>
    <p><strong>Not Entered:</strong> {{ registrations|rejectattr('attendance_status', 'equalto', 'entered')|list|length }}</p>
    {% endif %}
</div>

{% if registrations %}
<div class="table-responsive">
    <table class="table" id="registrationsTable">
        <thead>
            <tr>
                <th>#</th>
                <th>Timestamp</th>
                <th style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1)); font-weight: bold;">
                    <i class="fas fa-envelope"></i> Submitter Email
                </th>
                {% for field in form.fields %}
                <th>{{ field.label }}</th>
                {% endfor %}
                <th>Payment Status</th>
                <th>Attendance Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for reg in registrations %}
            <tr>
                <td>{{ reg.id }}</td>
                <td>{{ reg.timestamp }}</td>
                <td style="font-weight: 600; color: var(--primary-color);">
                    {{ reg.submitter_email or '-' }}
                </td>
                {% for field in form.fields %}
                <td>{{ reg[field.name] or '-' }}</td>
                {% endfor %}
                <td>
                    {% if reg.payment_status == 'completed' %}
                    <span class="badge badge-success">
                        <i class="fas fa-check-circle"></i> Paid
                    </span>
                    {% elif reg.payment_status == 'pending' %}
                    <span class="badge badge-warning">
                        <i class="fas fa-clock"></i> Pending
                    </span>
                    {% elif reg.payment_status == 'failed' %}
                    <span class="badge badge-danger">
                        <i class="fas fa-times-circle"></i> Failed
                    </span>
                    {% else %}
                    <span class="badge badge-secondary">
                        <i class="fas fa-minus"></i> N/A
                    </span>
                    {% endif %}
                </td>
                <td>
                    {% if reg.attendance_status == 'entered' %}
                    <span class="badge badge-success">
                        <i class="fas fa-check-circle"></i> Entered
                    </span>
                    <br>
                    <small style="color: #6c757d;">{{ reg.entry_time }}</small>
                    {% else %}
                    <span class="badge badge-warning">
                        <i class="fas fa-clock"></i> Not Entered
                    </span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('admin_verify_entry', regid=reg.registration_id, email=reg.submitter_email, event_id=event.id) }}" 
                       class="btn btn-sm btn-primary" 
                       title="Verify Entry">
                        <i class="fas fa-qrcode"></i> Verify
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state">
    <i class="fas fa-inbox fa-3x"></i>
    <p>No registrations yet for this event.</p>
</div>
{% endif %}

<script>
// Excel export is handled server-side
</script>

<style>
:root {
    --card-bg: white;
    --text-primary: #0f172a;
    --text-secondary: #64748b;
    --border-color: #e2e8f0;
    --table-bg: white;
    --table-header-bg: #f8f9fa;
    --table-border: #dee2e6;
    --info-bg: white;
    --empty-bg: #f8f9fa;
}

[data-theme="dark"] {
    --card-bg: #1e293b;
    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --border-color: #334155;
    --table-bg: #1e293b;
    --table-header-bg: #334155;
    --table-border: #475569;
    --info-bg: #1e293b;
    --empty-bg: #334155;
}

.btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.25rem;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    border: none;
    text-decoration: none;
    transition: all 0.2s ease;
}

.btn-secondary {
    background: var(--card-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
}

.btn-secondary:hover {
    background: var(--table-header-bg);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(15, 23, 42, 0.1);
}

.btn-success {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.875rem;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.info-card {
    background: var(--info-bg);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border: 1px solid var(--border-color);
}

.info-card h3 {
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.info-card p {
    color: var(--text-secondary);
}

.table-responsive {
    background: var(--table-bg);
    padding: 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    overflow-x: auto;
    border: 1px solid var(--border-color);
}

.table {
    width: 100%;
    margin-bottom: 0;
}

.table th {
    background: var(--table-header-bg);
    font-weight: 600;
    white-space: nowrap;
    color: var(--text-primary);
}

.table td, .table th {
    padding: 0.75rem;
    border-bottom: 1px solid var(--table-border);
    color: var(--text-primary);
}

.table td {
    color: var(--text-secondary);
}

.empty-state {
    text-align: center;
    padding: 3rem;
    background: var(--empty-bg);
    border-radius: 0.5rem;
    margin-top: 2rem;
    border: 1px solid var(--border-color);
}

.empty-state i {
    color: var(--text-secondary);
    margin-bottom: 1rem;
}

.empty-state p {
    font-size: 1.1rem;
    color: var(--text-secondary);
}

.badge {
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.badge-success {
    background: #dcfce7;
    color: #15803d;
}

.badge-warning {
    background: #fef3c7;
    color: #92400e;
}

.badge-danger {
    background: #fee2e2;
    color: #991b1b;
}

.badge-secondary {
    background: var(--table-header-bg);
    color: var(--text-secondary);
}
</style>
    </div>
    
    <script src="{{ url_for('static', filename='js/admin-theme.js') }}"></script>
</body>
</html>
